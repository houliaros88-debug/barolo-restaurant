const translations = {
  en: {
    page_title_home: 'Barolo | Italian Wine Bar Restaurant in Kos',
    nav_menu: 'Menu',
    nav_story: 'Story',
    nav_gallery: 'Gallery',
    nav_reservations: 'Reservations',
    nav_visit: 'Visit',
    hero_title: 'Italian Wine Bar Restaurant in Kos',
    hero_lead:
      'Traditional Italian pasta and pizza, paired with an all-Italian wine list and local Kos labels, with the sea just across the street. Perfect for romantic dinners, friends, and group gatherings.',
    hero_cta_book: 'Book a table',
    hero_cta_menu: 'Explore menu',
    hero_status_label: 'Status',
    hero_status_value: 'Closed now. Reopens 1 May',
    hero_status_note: 'Open 17:00 - 01:00 (closed Tuesday). Kitchen until 23:00.',
    hero_address_label: 'Address',
    hero_call_label: 'Call',
    menu_eyebrow: 'Menu Highlights',
    menu_title: 'Traditional Italian, crafted fresh daily',
    menu_intro:
      'Traditional Italian cuisine, prepared fresh every day. Made with top-quality ingredients and led by Executive Chef Nikos Iliadis and his team, alongside Chef Giannis Lamprou.',
    menu_cta_view: 'View menu',
    menu_cta_wine: 'Wine list',
    menu_item_tagliatelle_desc: 'Tender beef fillets, mushrooms, aroma of white truffle and fresh chives.',
    menu_item_gnocchi_desc:
      'Gnocchi with vegetable ratatouille, cherry tomatoes, broccoli, and an aromatic pomodoro sauce.',
    menu_item_fettuccine_desc: 'Napoli sauce with shrimp, mastic liqueur, shrimp bisque, and fresh basil.',
    menu_item_ravioli_desc:
      'Handmade ravioli with slow-cooked beef ragout, Barolo wine gravy, and freshly grated parmesan.',
    menu_wine_highlights_title: 'Wine list highlights',
    menu_wine_highlights_intro:
      'Italian classics and handpicked Kos labels, curated to pair with every table.',
    menu_wine_reds_title: 'Italian Reds',
    menu_wine_reds_desc: 'Deep, structured reds chosen for pasta, pizza, and long dinners.',
    menu_wine_whites_title: 'Italian Whites',
    menu_wine_whites_desc: 'Crisp coastal whites and aromatic blends for seafood and starters.',
    menu_wine_kos_title: 'Kos Labels',
    menu_wine_kos_desc: 'Local bottles that bring the island character to the table.',
    menu_wine_sparkling_title: 'Sparkling & Rosé',
    menu_wine_sparkling_desc: 'Bright, celebratory pours for aperitivo and sunset tables.',
    story_eyebrow: 'Our Story',
    story_title: 'Opened in 2025, rooted in Italian tradition',
    story_body:
      'When we opened our doors, we did not just want to serve Italian food. We wanted to create a place that feels easy and welcoming. A table where pasta and pizza are made with care, a glass is always poured with intention, and time moves a little slower. Over the last year, we have dedicated ourselves to finding the best wines, selecting Italian favorites and handpicking local bottles from Kos. Everything we do is about balance: quality without noise, hospitality without rushing, and an atmosphere that is calm, warm, and made for sharing.',
    story_list_one: 'Traditional pasta and pizza made daily.',
    story_list_two: 'Italian wines plus local Kos labels.',
    story_list_three: 'Sea-view evenings for romance, friends, and groups.',
    gallery_eyebrow: 'Gallery',
    gallery_title: 'From sea light to night glow',
    events_eyebrow: 'Private Events',
    events_title: 'Gatherings for romance, friends, and big groups',
    events_body:
      'Celebrate birthdays and group dinners with traditional Italian menus and a deep Italian and Kos wine list.',
    events_cta: 'Plan an event',
    reservations_eyebrow: 'Reservations',
    reservations_title: 'Reserve a table',
    reservations_body:
      'We are currently closed and reopen on 1 May. From then on we are open every day except Tuesday from 17:00 until 01:00, with the kitchen serving until 23:00. Walk-ins are welcome, but weekend tables go fast. Reserve early for sea-view seating.',
    form_label_name: 'Name',
    form_placeholder_name: 'Your name',
    form_label_email: 'Email',
    form_placeholder_email: 'you@email.com',
    form_label_phone: 'Phone (with country code)',
    form_placeholder_phone: '+30 690 000 0000',
    form_label_date: 'Date',
    form_label_time: 'Time',
    form_time_note: '17:00 - 23:00 (closed Tuesday)',
    form_label_guests: 'Guests',
    form_placeholder_guests: '2',
    form_label_requests: 'Special requests (optional)',
    form_placeholder_requests: 'Allergies, celebrations, seating preferences',
    form_button_submit: 'Request booking',
    form_note: 'Reopens 1 May. We will confirm by email. Closed on Tuesdays.',
    visit_eyebrow: 'Visit Barolo',
    visit_title: "Vasileos Georgiou V' 26, Kos 853 00, Greece",
    visit_body: 'Just across the street from the sea in Kos. Currently closed, reopening 1 May.',
    visit_open_label: 'Open',
    visit_open_value: 'From 1 May, 17:00 - 01:00',
    visit_kitchen_label: 'Kitchen',
    visit_kitchen_value: '17:00 - 23:00',
    visit_closed_label: 'Closed',
    visit_closed_value: 'Tuesday',
    footer_contact_label: 'Contact us',
    footer_open: 'Open 17:00 - 01:00 (closed Tuesday)',
    footer_kitchen: 'Kitchen until 23:00',
    footer_follow_label: 'Follow us',
    footer_login: 'Login',
    footer_copy: '© 2026 Barolo Wine Bar & Restaurant. All rights reserved.',
    menu_page_title: 'Barolo | Menu',
    menu_page_eyebrow: 'Menu',
    menu_page_heading: 'Menu for 2026 is in progress',
    menu_page_body:
      'Our full menu will be published soon. For now, please ask our team on arrival and we will guide you through the daily selections.',
    menu_page_back: 'Back to home',
    wine_page_title: 'Barolo | Wine List',
    wine_page_eyebrow: 'Wine List',
    wine_page_heading: 'Wine list for 2026 is in progress',
    wine_page_body: 'Our full wine list will be published soon.',
    status_thanks: 'Thank you. We will be in touch shortly.',
    status_invalid_time: 'Please choose a valid time.',
    status_time_window: 'Reservations are available between 17:00 and 23:00.',
    status_closed_tuesday: 'We are closed on Tuesdays. Please choose another day.',
    status_sending: 'Sending your request...',
    status_request_received: 'Request received. We will confirm by email.',
    status_booking_failed: 'Booking failed. Please try again.',
    status_booking_failed_later: 'Booking failed. Please try again later.',
  },
  el: {
    page_title_home: 'Barolo | Ιταλικό Wine Bar Restaurant στην Κω',
    nav_menu: 'Μενού',
    nav_story: 'Ιστορία',
    nav_gallery: 'Γκαλερί',
    nav_reservations: 'Κρατήσεις',
    nav_visit: 'Επίσκεψη',
    hero_title: 'Ιταλικό Wine Bar Restaurant στην Κω',
    hero_lead:
      'Παραδοσιακά ιταλικά ζυμαρικά και πίτσα, συνδυασμένα με μια αποκλειστικά ιταλική λίστα κρασιών και τοπικές ετικέτες από την Κω, με τη θάλασσα ακριβώς απέναντι. Ιδανικό για ρομαντικά δείπνα, φίλους και παρέες.',
    hero_cta_book: 'Κράτηση τραπεζιού',
    hero_cta_menu: 'Δείτε το μενού',
    hero_status_label: 'Κατάσταση',
    hero_status_value: 'Κλειστά τώρα. Επαναλειτουργία 1 Μαΐου',
    hero_status_note: 'Ανοιχτά 17:00 - 01:00 (κλειστά Τρίτη). Κουζίνα έως 23:00.',
    hero_address_label: 'Διεύθυνση',
    hero_call_label: 'Τηλέφωνο',
    menu_eyebrow: 'Επιλεγμένα πιάτα',
    menu_title: 'Παραδοσιακά ιταλικά, φρέσκα καθημερινά',
    menu_intro:
      'Παραδοσιακή ιταλική κουζίνα, μαγειρεμένη φρέσκα κάθε μέρα. Με κορυφαίες πρώτες ύλες και υπό την καθοδήγηση του Executive Chef Νίκου Ηλιάδη και της ομάδας του, μαζί με τον Chef Γιάννη Λάμπρου.',
    menu_cta_view: 'Δείτε το μενού',
    menu_cta_wine: 'Λίστα κρασιών',
    menu_item_tagliatelle_desc: 'Τρυφερά φιλέτα μοσχαριού, μανιτάρια, άρωμα λευκής τρούφας και φρέσκο σχοινόπρασο.',
    menu_item_gnocchi_desc:
      'Gnocchi με λαχανικά ρατατούιγ, ντοματίνια, μπρόκολο και αρωματική σάλτσα πομοντόρο.',
    menu_item_fettuccine_desc:
      'Σάλτσα Napoli με γαρίδες, λικέρ μαστίχας, bisque γαρίδας και φρέσκο βασιλικό.',
    menu_item_ravioli_desc:
      'Σπιτικά ραβιόλι με αργομαγειρεμένο ραγού μοσχαριού, σάλτσα κρασιού Barolo και φρεσκοτριμμένη παρμεζάνα.',
    menu_wine_highlights_title: 'Επιλεγμένα από τη λίστα κρασιών',
    menu_wine_highlights_intro:
      'Ιταλικά κλασικά και επιλεγμένες ετικέτες από την Κω, ώστε να ταιριάζουν με κάθε τραπέζι.',
    menu_wine_reds_title: 'Ιταλικά κόκκινα',
    menu_wine_reds_desc: 'Βαθιά, δομημένα κόκκινα για ζυμαρικά, πίτσα και μακριές βραδιές.',
    menu_wine_whites_title: 'Ιταλικά λευκά',
    menu_wine_whites_desc: 'Δροσερά παράκτια λευκά και αρωματικά χαρμάνια για θαλασσινά και ορεκτικά.',
    menu_wine_kos_title: 'Ετικέτες Κω',
    menu_wine_kos_desc: 'Τοπικές επιλογές που φέρνουν τον χαρακτήρα του νησιού στο τραπέζι.',
    menu_wine_sparkling_title: 'Αφρώδη & Ροζέ',
    menu_wine_sparkling_desc: 'Λαμπερά, εορταστικά ποτήρια για απεριτίβο και τραπέζια στο ηλιοβασίλεμα.',
    story_eyebrow: 'Η ιστορία μας',
    story_title: 'Άνοιξε το 2025, με ρίζες στην ιταλική παράδοση',
    story_body:
      'Όταν ανοίξαμε τις πόρτες μας, δεν θέλαμε απλώς να σερβίρουμε ιταλικό φαγητό. Θέλαμε να δημιουργήσουμε έναν χώρο που να νιώθεις άνετα και καλοδεχούμενος. Ένα τραπέζι όπου τα ζυμαρικά και η πίτσα φτιάχνονται με φροντίδα, ένα ποτήρι γεμίζει με πρόθεση και ο χρόνος κινείται λίγο πιο αργά. Τον τελευταίο χρόνο αφιερωθήκαμε στο να βρούμε τα καλύτερα κρασιά, επιλέγοντας ιταλικά αγαπημένα και διαλέγοντας προσεκτικά τοπικές ετικέτες από την Κω. Ό,τι κάνουμε είναι θέμα ισορροπίας: ποιότητα χωρίς φασαρία, φιλοξενία χωρίς βιασύνη και μια ατμόσφαιρα ήρεμη, ζεστή και φτιαγμένη για να μοιράζεσαι.',
    story_list_one: 'Παραδοσιακά ζυμαρικά και πίτσα φτιαγμένα καθημερινά.',
    story_list_two: 'Ιταλικά κρασιά μαζί με τοπικές ετικέτες από την Κω.',
    story_list_three: 'Βραδιές με θέα στη θάλασσα για ρομαντικές στιγμές, φίλους και παρέες.',
    gallery_eyebrow: 'Γκαλερί',
    gallery_title: 'Από το φως της θάλασσας στη νυχτερινή λάμψη',
    events_eyebrow: 'Ιδιωτικές εκδηλώσεις',
    events_title: 'Συναντήσεις για ρομαντισμό, φίλους και μεγάλες παρέες',
    events_body:
      'Γιορτάστε γενέθλια και ομαδικά δείπνα με παραδοσιακά ιταλικά μενού και μια πλούσια λίστα ιταλικών κρασιών και ετικετών από την Κω.',
    events_cta: 'Οργανώστε εκδήλωση',
    reservations_eyebrow: 'Κρατήσεις',
    reservations_title: 'Κρατήστε τραπέζι',
    reservations_body:
      'Είμαστε προσωρινά κλειστά και επαναλειτουργούμε την 1η Μαΐου. Από τότε είμαστε ανοιχτά κάθε μέρα εκτός Τρίτης από τις 17:00 έως τη 01:00, με την κουζίνα να σερβίρει έως τις 23:00. Οι επισκέψεις χωρίς κράτηση είναι ευπρόσδεκτες, αλλά τα τραπέζια του Σαββατοκύριακου γεμίζουν γρήγορα. Κάντε κράτηση νωρίς για θέσεις με θέα στη θάλασσα.',
    form_label_name: 'Όνομα',
    form_placeholder_name: 'Το όνομά σας',
    form_label_email: 'Email',
    form_placeholder_email: 'you@email.com',
    form_label_phone: 'Τηλέφωνο (με κωδικό χώρας)',
    form_placeholder_phone: '+30 690 000 0000',
    form_label_date: 'Ημερομηνία',
    form_label_time: 'Ώρα',
    form_time_note: '17:00 - 23:00 (κλειστά Τρίτη)',
    form_label_guests: 'Άτομα',
    form_placeholder_guests: '2',
    form_label_requests: 'Ειδικά αιτήματα (προαιρετικά)',
    form_placeholder_requests: 'Αλλεργίες, γιορτές, προτιμήσεις θέσης',
    form_button_submit: 'Αίτημα κράτησης',
    form_note: 'Επαναλειτουργία 1 Μαΐου. Θα επιβεβαιώσουμε με email. Κλειστά τις Τρίτες.',
    visit_eyebrow: 'Επισκεφθείτε το Barolo',
    visit_title: "Vasileos Georgiou V' 26, Kos 853 00, Greece",
    visit_body: 'Ακριβώς απέναντι από τη θάλασσα στην Κω. Κλειστά τώρα, επαναλειτουργία 1 Μαΐου.',
    visit_open_label: 'Ανοιχτά',
    visit_open_value: 'Από 1 Μαΐου, 17:00 - 01:00',
    visit_kitchen_label: 'Κουζίνα',
    visit_kitchen_value: '17:00 - 23:00',
    visit_closed_label: 'Κλειστά',
    visit_closed_value: 'Τρίτη',
    footer_contact_label: 'Επικοινωνία',
    footer_open: 'Ανοιχτά 17:00 - 01:00 (κλειστά Τρίτη)',
    footer_kitchen: 'Κουζίνα έως 23:00',
    footer_follow_label: 'Ακολουθήστε μας',
    footer_login: 'Σύνδεση',
    footer_copy: '© 2026 Barolo Wine Bar Restaurant. Με επιφύλαξη παντός δικαιώματος.',
    menu_page_title: 'Barolo | Μενού',
    menu_page_eyebrow: 'Μενού',
    menu_page_heading: 'Το μενού για το 2026 είναι υπό διαμόρφωση',
    menu_page_body:
      'Το πλήρες μενού μας θα δημοσιευθεί σύντομα. Προς το παρόν, ρωτήστε την ομάδα μας κατά την άφιξή σας και θα σας καθοδηγήσουμε στις ημερήσιες επιλογές.',
    menu_page_back: 'Πίσω στην αρχική',
    wine_page_title: 'Barolo | Λίστα κρασιών',
    wine_page_eyebrow: 'Λίστα κρασιών',
    wine_page_heading: 'Η λίστα κρασιών για το 2026 είναι υπό διαμόρφωση',
    wine_page_body: 'Η πλήρης λίστα κρασιών μας θα δημοσιευθεί σύντομα.',
    status_thanks: 'Ευχαριστούμε. Θα επικοινωνήσουμε σύντομα.',
    status_invalid_time: 'Παρακαλώ επιλέξτε έγκυρη ώρα.',
    status_time_window: 'Οι κρατήσεις είναι διαθέσιμες μεταξύ 17:00 και 23:00.',
    status_closed_tuesday: 'Είμαστε κλειστά τις Τρίτες. Παρακαλώ επιλέξτε άλλη ημέρα.',
    status_sending: 'Αποστολή αιτήματος...',
    status_request_received: 'Το αίτημα ελήφθη. Θα επιβεβαιώσουμε με email.',
    status_booking_failed: 'Η κράτηση απέτυχε. Παρακαλώ δοκιμάστε ξανά.',
    status_booking_failed_later: 'Η κράτηση απέτυχε. Παρακαλώ δοκιμάστε αργότερα.',
  },
};

const LANG_STORAGE_KEY = 'barolo-lang';

const normalizeLang = (lang) => (lang === 'el' ? 'el' : 'en');

const getStoredLang = () => {
  try {
    return localStorage.getItem(LANG_STORAGE_KEY);
  } catch (error) {
    return null;
  }
};

const getPreferredLang = () => {
  const stored = getStoredLang();
  if (stored) {
    return normalizeLang(stored);
  }
  const browserLang = (navigator.language || '').slice(0, 2);
  return normalizeLang(browserLang);
};

const getActiveLang = () => document.documentElement.dataset.lang || 'en';

const applyTranslations = (lang) => {
  const dictionary = translations[lang] || translations.en;
  document.documentElement.dataset.lang = lang;
  document.documentElement.lang = lang;
  document.querySelectorAll('[data-i18n]').forEach((element) => {
    const key = element.dataset.i18n;
    if (dictionary[key]) {
      element.textContent = dictionary[key];
    }
  });
  document.querySelectorAll('[data-i18n-placeholder]').forEach((element) => {
    const key = element.dataset.i18nPlaceholder;
    if (dictionary[key]) {
      element.setAttribute('placeholder', dictionary[key]);
    }
  });
};

const updateLangToggles = (lang) => {
  document.querySelectorAll('[data-lang-toggle]').forEach((toggle) => {
    toggle.setAttribute('aria-checked', lang === 'el' ? 'true' : 'false');
  });
};

const setLanguage = (lang) => {
  const normalized = normalizeLang(lang);
  applyTranslations(normalized);
  updateLangToggles(normalized);
  try {
    localStorage.setItem(LANG_STORAGE_KEY, normalized);
  } catch (error) {
    // Ignore storage failures.
  }
};

const t = (key) => {
  const lang = getActiveLang();
  return translations[lang]?.[key] || translations.en?.[key] || key;
};

setLanguage(getPreferredLang());

document.querySelectorAll('[data-lang-toggle]').forEach((toggle) => {
  toggle.addEventListener('click', () => {
    const nextLang = getActiveLang() === 'el' ? 'en' : 'el';
    setLanguage(nextLang);
  });
});

const navToggle = document.querySelector('.nav-toggle');
const navLinks = document.querySelector('.nav-links');

if (navToggle && navLinks) {
  navToggle.addEventListener('click', () => {
    const isOpen = document.body.classList.toggle('nav-open');
    navToggle.setAttribute('aria-expanded', String(isOpen));
  });

  navLinks.querySelectorAll('a').forEach((link) => {
    link.addEventListener('click', () => {
      document.body.classList.remove('nav-open');
      navToggle.setAttribute('aria-expanded', 'false');
    });
  });
}

const revealItems = document.querySelectorAll('[data-reveal]');
if (revealItems.length) {
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    },
    { threshold: 0.18 }
  );

  revealItems.forEach((item) => observer.observe(item));
}

const gallery = document.querySelector('.gallery-grid');
const galleryButtons = document.querySelectorAll('.gallery-arrow');
if (gallery && galleryButtons.length) {
  const getScrollAmount = () => Math.max(gallery.clientWidth * 0.6, 240);
  galleryButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const direction = button.dataset.dir === 'next' ? 1 : -1;
      gallery.scrollBy({
        left: direction * getScrollAmount(),
        behavior: 'smooth',
      });
    });
  });
}

const reservationForm = document.querySelector('#reservation-form');
if (reservationForm) {
  const status = reservationForm.querySelector('.form-status');
  const submitButton = reservationForm.querySelector('button[type="submit"]');

  const setStatus = (message, state) => {
    if (!status) {
      return;
    }
    status.textContent = message;
    if (state) {
      status.dataset.state = state;
    } else {
      delete status.dataset.state;
    }
  };

  reservationForm.addEventListener('submit', async (event) => {
    event.preventDefault();

    const formData = new FormData(reservationForm);
    if (formData.get('website')) {
      setStatus(t('status_thanks'), 'success');
      reservationForm.reset();
      return;
    }

    const payload = {
      name: String(formData.get('name') || '').trim(),
      email: String(formData.get('email') || '').trim(),
      phone: String(formData.get('phone') || '').trim(),
      date: String(formData.get('date') || '').trim(),
      time: String(formData.get('time') || '').trim(),
      guests: Number(formData.get('guests') || 0),
      notes: String(formData.get('notes') || '').trim() || null,
    };

    const timeMatch = payload.time.match(/^(\d{2}):(\d{2})$/);
    if (!timeMatch) {
      setStatus(t('status_invalid_time'), 'error');
      return;
    }

    const hours = Number(timeMatch[1]);
    const minutes = Number(timeMatch[2]);
    const totalMinutes = hours * 60 + minutes;
    const isAllowedTime = totalMinutes >= 17 * 60 && totalMinutes <= 23 * 60;

    if (!isAllowedTime) {
      setStatus(t('status_time_window'), 'error');
      return;
    }

    if (payload.date) {
      const [year, month, day] = payload.date.split('-').map(Number);
      if (year && month && day) {
        const serviceDate = new Date(year, month - 1, day);
        if (serviceDate.getDay() === 2) {
          setStatus(t('status_closed_tuesday'), 'error');
          return;
        }
      }
    }

    setStatus(t('status_sending'), 'loading');
    if (submitButton) {
      submitButton.disabled = true;
    }

    try {
      const response = await fetch('/api/book', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(payload),
      });

      let result = {};
      try {
        result = await response.json();
      } catch (error) {
        result = {};
      }

      if (!response.ok) {
        throw new Error(result.error || t('status_booking_failed'));
      }

      setStatus(result.message || t('status_request_received'), 'success');
      reservationForm.reset();
    } catch (error) {
      setStatus(error.message || t('status_booking_failed_later'), 'error');
    } finally {
      if (submitButton) {
        submitButton.disabled = false;
      }
    }
  });
}
